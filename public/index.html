<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./stylesheets/style.css">
    <title>They chat!</title>
</head>

<body>
    <div id="app">
        <h1>the index.js router works fine.</h1>
        <h2>hello there, begin to chat!</h2>
        <div class="user-window">
            <p v-for="user in activeUsers">{{user}}</p>
        </div>
        <div class="chat-window">
            <h2>chat window</h2>
            <ul class="chat-messages" v-if="messages.length">
                <p v-for="msg in messages" :key="msg">
                    > {{msg.user}} says: {{msg.body}}
                </p>
            </ul>
        </div>
        <input type="text" v-model="text" v-on:keyup.enter="submit" placeholder="message">
    </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
<script>
    var socket = io()
    new Vue({
        el: "#app",
        data() {
            return {
                message: {
                    "type": "",
                    "body": "",
                    "user": "",
                    "timestamp": "",
                },
                text: "",
                activeUsers: [],
                messages: [],
            }
        },
        created() {
            socket.on('user connected', socketid => {
                this.activeUsers.push(socketid)
            })
            socket.on('chat message', msg => {
                this.messages.push(msg)
            })
        },
        methods: {
            submit: function () {
                this.message.type = "chat"
                this.message.user = socket.id
                this.message.body = this.text
                this.message.timestamp = moment().calendar()
                socket.emit('chat message', this.message)
                this.text = ""
                this.message = {
                    "type": "",
                    "body": "",
                    "user": "",
                    "timestamp": "",
                }
            }
        }
    })
</script>

</html>